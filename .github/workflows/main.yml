name: Generate PlantUML images
on: push

jobs:
  diagrams:
    name: Generate PlantUML images
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      REPO: https://${{github.actor}}:${{secrets.GITHUB_TOKEN}}@github.com/${{github.repository}}.git
    steps:
      - name: Check out repository
        uses: actions/checkout@v2
      - name: Process diagrams
        uses: Timmy/plantuml-action@v1
        with:
          args: '-svg *.puml'
      - name: Write last modified
        run: echo '!define _LAST_MODIFIED_ ' date > config/last_modified.puml
      - name: Commit files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git commit -m 'Automatically generated PlantUML images.' -a
          git push origin
